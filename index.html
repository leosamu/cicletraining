<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seguimiento de Entrenamiento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <style>
        body {
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: auto;
        }
        .hidden {
            display: none;
        }
        .series-counter {
            font-weight: bold;
            color: black;
        }
        .series-completed {
            color: green;
        }
        .editable-input {
            border: 1px solid #ccc;
            padding: 5px;
            width: 50px;
            text-align: center;
        }
        .timer-icon {
            font-size: 20px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-wrapper blue">
            <a href="#" class="brand-logo center">Entrenamiento</a>
            <ul id="nav-mobile" class="left hide-on-med-and-down">
                <li><a href="#" onclick="seleccionarEntrenamiento('4+2')">Potencia (4+2)</a></li>
                <li><a href="#" onclick="seleccionarEntrenamiento('2+1')">Potencia (2+1)</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <h3>Seguimiento de Entrenamiento</h3>
        <div id="menu-rutina" class="hidden">
            <h5>Selecciona tu rutina</h5>
            <div id="opciones-rutina" class="collection"></div>
        </div>

        <div id="rutina" class="hidden">
            <h5>Rutina Seleccionada</h5>
            <div id="contenido-rutina"></div>
        </div>
    </div>

    <script>
        let rutinaActual = null;
        let archivoActual = "";
        let intervalos = {};

        function seleccionarEntrenamiento(tipo) {
            document.getElementById('menu-rutina').classList.remove('hidden');
            document.getElementById('opciones-rutina').innerHTML = '';
            
            let opciones = tipo === '4+2' ? ["Opción 1", "Opción 2", "Opción 3", "Opción 4", "Opción 5", "Opción 6"] : ["Opción 1", "Opción 2", "Opción 3"];
            opciones.forEach(opcion => {
                let item = document.createElement('a');
                item.className = "collection-item";
                item.textContent = opcion;
                item.href = "#";
                item.onclick = () => cargarRutina(tipo, opcion);
                document.getElementById('opciones-rutina').appendChild(item);
            });
        }

        function cargarRutina(tipo, opcion) {
            document.getElementById('rutina').classList.remove('hidden');
            document.getElementById('contenido-rutina').innerHTML = `<p>Cargando rutina ${tipo} - ${opcion}...</p>`;
            
            archivoActual = `rutinas/${tipo.replace('+', '')}_opcion${opcion.split(' ')[1]}.yml`;
            let storedData = localStorage.getItem(archivoActual);
            
            if (storedData) {
                rutinaActual = JSON.parse(storedData);
                mostrarRutina();
            } else {
                fetch(archivoActual)
                    .then(response => response.text())
                    .then(yamlText => {
                        rutinaActual = jsyaml.load(yamlText);
                        guardarEnLocalStorage();
                        mostrarRutina();
                    })
                    .catch(error => {
                        document.getElementById('contenido-rutina').innerHTML = `<p>Error cargando la rutina.</p>`;
                        console.error("Error cargando el archivo YAML: ", error);
                    });
            }
        }

        function mostrarRutina() {
            let contenido = `<h4>${rutinaActual.nombre}</h4>`;
            rutinaActual.bloques.forEach((bloque, bloqueIdx) => {
                contenido += `<h5>${bloque.nombre}</h5>`;
                bloque.ejercicios.forEach((ejercicio, ejercicioIdx) => {
                    let descanso = parseInt(ejercicio.descanso) || 0;
                    contenido += `
                        <div class="card-panel">
                            <p><b>${ejercicio.nombre}</b></p>
                            <p>
                                <input type="text" class="editable-input" value="${ejercicio.peso}" onchange="actualizarValor(${bloqueIdx}, ${ejercicioIdx}, 'peso', this.value)"> kg -
                                <input type="text" class="editable-input" value="${ejercicio.series}" onchange="actualizarValor(${bloqueIdx}, ${ejercicioIdx}, 'series', this.value)"> series x 
                                <input type="text" class="editable-input" value="${ejercicio.repeticiones}" onchange="actualizarValor(${bloqueIdx}, ${ejercicioIdx}, 'repeticiones', this.value)"> repeticiones -
                                <input type="text" class="editable-input" value="${ejercicio.descanso}" onchange="actualizarValor(${bloqueIdx}, ${ejercicioIdx}, 'descanso', this.value)"> descanso
                                <button onclick="modificarSeries(${bloqueIdx}, ${ejercicioIdx}, 1)">+</button>
                                <button onclick="modificarSeries(${bloqueIdx}, ${ejercicioIdx}, -1)">-</button>
                                <span id="timer-${bloqueIdx}-${ejercicioIdx}" class="timer-icon"></span>
                            </p>
                        </div>`;
                });
            });
            document.getElementById('contenido-rutina').innerHTML = contenido;
        }

        function modificarSeries(bloqueIdx, ejercicioIdx, cambio) {
            let estado = document.getElementById(`timer-${bloqueIdx}-${ejercicioIdx}`);
            estado.innerHTML = "⏳";
            setTimeout(() => {
                new Audio('beep.mp3').play();
                estado.innerHTML = "✅";
            }, (rutinaActual.bloques[bloqueIdx].ejercicios[ejercicioIdx].descanso || 0) * 1000);
        }
    </script>
</body>
</html>
